<!DOCTYPE html>
<html>

<head>
  <title>d3.js with leaflet.js</title>
  <meta charset="utf-8" />

  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7/leaflet.css" />
  <script src="http://d3js.org/d3.v3.min.js"></script>

  <script src="http://cdn.leafletjs.com/leaflet-0.7/leaflet.js">
  </script>

</head>

<body>

  <div id="map" style="width: 1200px; height: 500px; margin-left: auto; margin-right: auto"></div>

  <script type="text/javascript">

    var map = L.map('map').setView([38.728318, -98], 4);
    mapLink =
      '<a href="http://openstreetmap.org">OpenStreetMap</a>';
    L.tileLayer(
      'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; ' + mapLink + ' Contributors',
        maxZoom: 18,
      }).addTo(map);

    /* Initialize the SVG layer */
    map._initPathRoot()

    /* We simply pick up the SVG from the map object */
    var svg = d3.select("#map").select("svg"),
      g = svg.append("g");

    d3.json("./wiki_shootings_with_coords.json", function (result) {
      /* Add a LatLng object to each item in the dataset */
      result.shootings.forEach(function (d) {
        d.LatLng = new L.LatLng(
          d.coords.lat,
          d.coords.lon
        )
      })

      var feature = g.selectAll("circle")
        .data(result.shootings)
        .enter().append("circle")
        .style("stroke", "black")
        .style("opacity", .6)
        .style("fill", "red")
        .attr("r", 3);

      map.on("viewreset", update);
      update();

      function update() {
        feature.attr("transform",
          function (d) {
            return "translate(" +
              map.latLngToLayerPoint(d.LatLng).x + "," +
              map.latLngToLayerPoint(d.LatLng).y + ")";
          }
        )
      }
    })
  </script>
</body>

</html>